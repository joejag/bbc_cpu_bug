"use strict";function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function searchboxDrawerWrapper(e,t){function n(e){e.blur(),e.focus()}var a=["",null,"all","all:learning","iplayer:tv","iplayer_cbbc","iplayer_cbeebies","iplayer:radio","sounds"],r=["/education","/iwonder","/iwondercommunity","/guides","/timelines","/arts","/earth","/history","/science","/religion","/makeitdigital","/dishup","/ulsterscots","/aboutthebbc","/annualreport","/bbcfilms","/bbctrust","/branding","/broadcastinghouse","/careers","/charityappeals","/pudsey","/climateasia","/commissioning","/copyright","/developer","/diversity","/fmguidelines","/foi","/helpandfeedback","/historyofthebbc","/informationandarchives","/mediaaction","/mediacentre","/mypension","/partnersandsuppliers","/performingartsfund","/privacy","/production","/reception","/responsibility","/safety","/social","/supplying","/terms","/writerslicence","/writersroom","/newsbeat","/terrificscientific(?!/map|/termsandconditions|/class-results)","/tomorrowsworld","/culture","/capital","/autos","/future","/travel","/corporate2","genome.ch.bbc.co.uk"],s={app:null,conf:null,searchScope:null,loadedSearchbox:!1,loadingSearchbox:!1,drawerLoaded:!1,intervalId:0,resizeId:0,resizeThrottleMs:200,DRAWER_NAME:"drawer-search",run:function(e){var n=this;t.ready(function(){n.conf=e;var t=window.location.pathname;n.searchScope=e.searchScope,n.hideOnVariant(e.variant,n.searchScope)||!n.isInWhiteList(n.searchScope,n.scopeWhiteList)||n.isSuppressedPath(t)||(n.loadSearchboxCss(e,function(){n.cssLoaded(e)}),n.setEventListeners(),n.applyScopeClasses(n.searchScope),n.applyTouchClasses())})}};return s.applyTouchClasses=function(){this.touchEnabled()?document.documentElement.className+=" se-touch":document.documentElement.className+=" se-no-touch"},s.applyScopeClasses=function(e){var t="";if("sounds"===e)return t+=" se-sounds-theme",void(document.documentElement.className+=t);var n=new RegExp("(iplayer):?(radio)?","ig"),a=n.exec(e);a&&(a[2]?t=" se-iplayer-radio-theme":a[1]&&(t=" se-iplayer-theme"),document.documentElement.className+=t)},s.touchEnabled=function(){return!!("ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch||window.hasOwnProperty&&(window.hasOwnProperty("ontouchstart")||window.DocumentTouch&&document instanceof window.DocumentTouch||navigator.msMaxTouchPoints))||"ontouchstart"in window},s.scopeWhiteList=a,s.isInWhiteList=function(e,t){var n=!1;if("function"==typeof t.indexOf)n=t.indexOf(e)!==-1;else for(var a=0;a<t.length;a++)if(t[a]===e){n=!0;break}return n},s.isSuppressedPath=function(e){for(var t=0;t<r.length;t++){var n="^".concat(r[t]),a=new RegExp(n,"i");if(a.test(e))return!0}return!1},s.hideOnVariant=function(e,t){if(["cbeebies","cbbc"].join(" ").indexOf(e)>-1){var n=["iplayer:tv"];return!this.isInWhiteList(t,n)}return!1},s.viewAllResults=function(){function e(e,t){var n=document.createElement("input");return n.type="hidden",n.name=e,n.value=t,n}var t=document.getElementById("searchboxDrawerForm");t&&(t.appendChild(e("search_suggestion_type","serp")),t.appendChild(e("action_name","search")),t.appendChild(e("action_type","view-all-results")),t.submit())},s.isOrbSearchVisible=function(){var e=document.getElementById("orb-search-form"),t=e.currentStyle?e.currentStyle.display:getComputedStyle(e,null).display;return"none"!==t},s.loadSearchboxCss=function(t,n){window.searchboxIEVersion&&8===window.searchboxIEVersion?e.loadCss(t.searchboxAppStaticPrefix+"/style/fixed.css",n):e.loadCss(t.searchboxAppStaticPrefix+"/style/enhanced.css",n)},s.cssLoaded=function(t){e.addDrawer(this.DRAWER_NAME,document.createElement("div"),this.createContent(t)),this.drawerLoaded=!0;var n=document.getElementById("orb-search-q");n.value&&this.handleInput(n)},s.loadSearchboxDrawer=function(e){this.loadingSearchbox=!0,require.config({paths:{"bbc-search/searchbox-app":this.conf.searchboxAppStaticPrefix+"/app.min"}}),require(["bbc-search/searchbox-app"],e)},s.createContent=function(e){var t=document.createElement("div");return t.setAttribute("class","orb-panel se-searchbox-app"),t.setAttribute("id","se-searchbox-app"),t.innerHTML=e.searchFormHtml,t},s.watchInput=function(e){var t=this,n=function(){e.value&&t.handleInput(e)};e.addEventListener?e.addEventListener("input",n):e.attachEvent&&e.attachEvent("onpropertychange",function(e){"value"===e.propertyName&&n()})},s.orbSearchClick=function(e){e.preventDefault(),this.handleInput(document.getElementById("orb-search-q"))},s.handleWindowResize=function(e){var t=document.querySelector(".orb-nav-search");this.isOrbSearchVisible()?t.removeEventListener("click",e,!0):t.addEventListener("click",e,!0)},s.setEventListeners=function(){var e=this,t=document.getElementById("orb-search-q"),n=document.getElementById("orb-panels"),a=function(){n.scrollTop=0};if(this.watchInput(t),document.addEventListener){var r=this.orbSearchClick.bind(this);window.addEventListener("resize",function(){clearTimeout(e.resizeId),e.resizeId=setTimeout(function(){e.handleWindowResize(r)},e.resizeThrottleMs)}),this.handleWindowResize(r),n.addEventListener("scroll",a)}},s.handleInput=function(t){var a=this;if(this.drawerLoaded){var r="se-searchbox-input-field",s=t,o=document.getElementById(r),i=e.getDrawerState(this.DRAWER_NAME);"hidden"===i&&(window.searchboxIEVersion||(document.getElementById("orb-header").navMode="mouse"),this.addDrawerStyles(),e.getMastheadDrawer().showPanel(this.DRAWER_NAME)),o.focus(),o.value=s.value,s.value="",this.loadingSearchbox||this.loadedSearchbox?this.loadedSearchbox&&(this.app.setQuery(o.value),n(o)):this.loadSearchboxDrawer(function(t){var r=e.updateDrawerHeight.bind(a,a.DRAWER_NAME),s=a.closeSearchboxDrawer.bind(a),i=a.viewAllResults.bind(a),c={changeHandler:r,closeHandler:s,viewResults:i,searchScope:a.searchScope,isSearchPage:window.SEARCHBOX.searchPage||!1,isResponsive:!window.searchboxIEVersion};a.app=new t(c),a.loadedSearchbox=!0,n(o)})}},s.closeSearchboxDrawer=function(){var t=document.getElementById("orb-search-q");e.getMastheadDrawer().hidePanel(),this.removeDrawerStyles(),t.focus()},s.addDrawerStyles=function(){var e=document.getElementById("orb-panels");this.cssUtils.addClass(e,"se-panel-active")},s.removeDrawerStyles=function(){var e=document.getElementById("orb-panels");this.cssUtils.removeClass(e,"se-panel-active")},s.cssUtils={addClass:function(e,t){this.hasClass(e,t)||(e.className+=" "+t)},removeClass:function(e,t){this.hasClass(e,t)&&(e.className=e.className.replace(this.classRegex(t),""))},hasClass:function(e,t){return!!e.className.match(this.classRegex(t))},classRegex:function(e){return new RegExp("(\\s|^)"+e+"(\\s|$)")}},s}"function"==typeof define&&define.amd&&define(["orb/nav","orb/lib/_$"],searchboxDrawerWrapper),"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports&&(module.exports=searchboxDrawerWrapper);
//# sourceMappingURL=searchboxDrawer.js.map
